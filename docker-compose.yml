services:
  postgres:
    image: postgres:16-alpine
    environment:
      POSTGRES_DB: fis
      POSTGRES_USER: fis
      POSTGRES_PASSWORD: fis
    ports:
      - "5432:5432"

  redis:
    image: redis:7.2-alpine
    ports:
      - "6379:6379"

  rabbitmq:
    image: rabbitmq:3.13-management-alpine
    ports:
      - "5672:5672"
      - "15672:15672"

  otel-collector:
    image: otel/opentelemetry-collector-contrib:0.118.0
    command: ["--config=/etc/otel/config.yaml"]
    volumes:
      - ./deploy/otel/config.yaml:/etc/otel/config.yaml:ro
    ports:
      - "4317:4317"
      - "4318:4318"

  fis-process:
    build: .
    depends_on:
      - postgres
      - redis
      - rabbitmq
      - otel-collector
    environment:
      DB_URL: jdbc:postgresql://postgres:5432/fis
      DB_USERNAME: fis
      DB_PASSWORD: fis
      DB_DRIVER: org.postgresql.Driver
      REDIS_HOST: redis
      REDIS_PORT: 6379
      RABBITMQ_HOST: rabbitmq
      RABBITMQ_PORT: 5672
      RABBITMQ_USERNAME: guest
      RABBITMQ_PASSWORD: guest
      MANAGEMENT_OTLP_METRICS_EXPORT_URL: http://otel-collector:4318/v1/metrics
      FIS_SECURITY_ENABLED: true
      FIS_JWT_HMAC_SECRET: 01234567890123456789012345678901
      SERVER_SSL_ENABLED: false
      RABBITMQ_SSL_ENABLED: false
      REDIS_SSL_ENABLED: false
    ports:
      - "8080:8080"
